<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD.PERUS - Regional 2 - Santa Maria</title>
    
    <!-- Scripts Externos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #ffffff;
            color: #000000;
        }

        @media print {
            @page { margin: 0; }
            .print-landscape { size: A4 landscape !important; }
            .print-portrait { size: A4 portrait !important; }
            body > *:not(#printContainer) { display: none !important; }
            #printContainer { display: block !important; width: 100%; }
            .print-page { 
                page-break-after: always; 
                height: 95vh; 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                padding: 30px; 
                box-sizing: border-box;
            }
            .chart-controls, .color-selector, .print-hidden { display: none !important; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #000000; border-radius: 10px; }
        
        .card-clean {
            background-color: #ffffff;
            border: 1px solid #f3f4f6;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .btn-exit { background-color: #ef4444; color: white; }
    </style>
</head>
<body class="transition-colors duration-300 antialiased text-black">

    <!-- NAVBAR -->
    <nav class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-100 z-50 px-6 flex items-center justify-between print-hidden shadow-sm">
        <div class="flex items-center gap-3">
            <!-- LOGOTIPO NO SITE (Substitua o src pelo link da sua imagem) -->
            <img src="https://via.placeholder.com/150x150?text=LOGO" alt="Logo" class="w-10 h-10 object-contain rounded-lg" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1000/1000944.png'">
            <div>
                <h1 class="text-lg font-black uppercase leading-none">AD.PERUS</h1>
                <p class="text-[10px] font-bold text-gray-400 tracking-widest uppercase">Regional 2 - Santa Maria</p>
            </div>
        </div>
        <div class="flex items-center gap-4 text-black">
            <div id="sync-status" class="flex items-center gap-2 px-3 py-1 bg-gray-50 rounded-full text-[10px] font-bold uppercase tracking-tighter text-black">
                <span id="sync-dot" class="w-2 h-2 bg-gray-300 rounded-full"></span> <span id="sync-text">Conectando...</span>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="pt-24 px-4 md:px-8 max-w-[1600px] mx-auto pb-12 print-hidden text-black">
        
        <div class="flex flex-col xl:flex-row xl:items-end justify-between gap-6 mb-10 text-black">
            <div>
                <h2 class="text-3xl font-black tracking-tight uppercase text-black">Consolidado Regional</h2>
                <p class="text-gray-400 font-medium mt-1 uppercase text-[10px] tracking-widest font-bold text-black">Gestão Regional - Dados Reais</p>
            </div>
            
            <div class="flex flex-wrap items-center gap-3 text-black">
                <button onclick="requestAdminAccess()" class="flex items-center gap-2 bg-black text-white px-5 py-2.5 rounded-xl text-xs font-bold uppercase shadow-sm hover:bg-gray-800 transition-colors text-white">
                    <i data-lucide="lock" class="w-4 h-4 text-white"></i> Admin
                </button>
                <button onclick="showPrintSelection()" class="flex items-center gap-2 border border-black text-black px-5 py-2.5 rounded-xl text-xs font-bold uppercase hover:bg-gray-50 transition-all text-black">
                    <i data-lucide="printer" class="w-4 h-4 text-black text-black"></i> Imprimir Relatório
                </button>

                <div class="flex flex-wrap items-center bg-gray-50 border border-gray-100 rounded-xl p-1 text-black">
                    <select id="yearFilter" class="bg-transparent pl-3 pr-8 py-2 text-[10px] font-black uppercase outline-none border-r border-gray-200 text-black" onchange="updateDashboard()">
                        <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option>
                    </select>
                    <select id="sectorFilter" class="bg-transparent pl-3 pr-8 py-2 text-[10px] font-black uppercase outline-none border-r border-gray-200 text-black" onchange="onSectorChange()">
                        <option value="Todos">Todos Setores</option>
                        <option value="JARDIM ALMANARA">Setor Almanara</option>
                        <option value="VILA ACRE">Setor Vila Acre</option>
                        <option value="CASA VERDE ALTA">Setor Casa Verde</option>
                        <option value="VILA SANTA MARIA">Setor Vila Santa Maria</option>
                    </select>
                    <select id="churchFilter" class="bg-transparent pl-3 pr-8 py-2 text-[10px] font-black uppercase outline-none text-black" onchange="updateDashboard()">
                        <option value="Todas">Todas Igrejas</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- INDICADORES -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 text-black text-black text-black">
            <div class="card-clean p-6 rounded-3xl text-black border-black/10">
                <p class="text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest text-black">Entradas Totais</p>
                <p id="kpi-income" class="text-2xl font-black text-blue-600">R$ 0,00</p>
            </div>
            <div class="card-clean p-6 rounded-3xl text-black border-black/10">
                <p class="text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest text-black">Saídas Totais</p>
                <p id="kpi-expense" class="text-2xl font-black text-rose-600">R$ 0,00</p>
            </div>
            <div class="card-clean p-6 rounded-3xl text-black border-black/10">
                <p class="text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest text-black">Saldo Regional</p>
                <p id="kpi-balance" class="text-2xl font-black text-indigo-600">R$ 0,00</p>
            </div>
            <div class="card-clean p-6 rounded-3xl text-black border-black/10">
                <p class="text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest text-black">Unidades</p>
                <p id="kpi-active" class="text-2xl font-black text-black">0 Unid.</p>
            </div>
        </div>

        <!-- GRÁFICOS -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8 text-black">
            <div class="lg:col-span-8 bg-white p-8 rounded-[40px] border border-gray-100 shadow-sm relative text-black">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4 text-black">
                    <h3 class="font-black text-lg uppercase flex items-center gap-3 text-black text-black">
                        <span class="w-1.5 h-6 bg-black rounded-full text-black"></span> Evolução Mensal
                    </h3>
                    <div class="flex items-center gap-4 chart-controls text-black text-black">
                        <label class="flex items-center gap-2 cursor-pointer text-black">
                            <input type="checkbox" id="showLabelsMain" onchange="updateDashboard()" checked class="w-4 h-4 accent-black text-black">
                            <span class="text-[10px] font-black uppercase text-gray-400 text-black">Exibir Valores</span>
                        </label>
                        <select id="colorMain" onchange="updateDashboard()" class="text-[10px] font-black uppercase bg-gray-50 border-none rounded-lg px-3 py-1.5 outline-none focus:ring-1 ring-black text-black">
                            <option value="default">Azul/Vermelho</option>
                            <option value="emerald">Verde/Rosa</option>
                            <option value="modern">Índigo/Laranja</option>
                            <option value="vibrant">Roxo/Amarelo</option>
                            <option value="ocean">Oceano/Pink</option>
                        </select>
                    </div>
                </div>
                <div class="h-[400px] text-black"><canvas id="mainChart"></canvas></div>
            </div>

            <div class="lg:col-span-4 bg-white p-8 rounded-[40px] border border-gray-100 shadow-sm relative text-black">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4 text-black text-black text-black text-black">
                    <h3 class="font-black text-lg uppercase flex items-center gap-3 text-black">
                        <span class="w-1.5 h-6 bg-black rounded-full text-black text-black text-black"></span> Saúde
                    </h3>
                    <div class="flex items-center gap-3 chart-controls text-black text-black">
                        <label class="flex items-center gap-2 cursor-pointer text-black text-black">
                            <input type="checkbox" id="showLabelsPie" onchange="updateDashboard()" checked class="w-4 h-4 accent-black">
                            <span class="text-[10px] font-black uppercase text-gray-400 text-black text-black text-black text-black">Valores</span>
                        </label>
                    </div>
                </div>
                <div class="h-[400px] text-black"><canvas id="pieChart"></canvas></div>
            </div>

            <div class="lg:col-span-12 bg-white p-8 rounded-[40px] border border-gray-100 shadow-sm relative text-black text-black">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4 text-black text-black text-black">
                    <h3 class="font-black text-lg uppercase flex items-center gap-3 text-black">
                        <span class="w-1.5 h-6 bg-black rounded-full text-black text-black text-black text-black"></span> Ranking Regional de Saldo
                    </h3>
                    <div class="flex items-center gap-4 chart-controls text-black text-black">
                        <label class="flex items-center gap-2 cursor-pointer text-black">
                            <input type="checkbox" id="showLabelsRanking" onchange="updateDashboard()" checked class="w-4 h-4 accent-black text-black">
                            <span class="text-[10px] font-black uppercase text-gray-400 text-black text-black text-black">Valores</span>
                        </label>
                    </div>
                </div>
                <div class="h-[500px] text-black"><canvas id="rankingChart"></canvas></div>
            </div>
        </div>

        <div id="tableToggleContainer" class="flex justify-center mt-10">
            <button onclick="toggleTableVisibility()" class="flex items-center gap-2 px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-500 rounded-2xl text-[10px] font-black uppercase transition-all">
                <i data-lucide="list" class="w-4 h-4 text-black"></i> <span id="toggleText">Ver Listagem Completa</span>
            </button>
        </div>

        <div id="tableSection" class="bg-white border border-gray-100 rounded-[40px] overflow-hidden hidden transition-all duration-500 mt-8 text-black text-black">
            <div class="p-8 border-b border-gray-50 flex flex-col md:flex-row md:items-center justify-between gap-6 text-black text-black">
                <h3 class="font-black text-xl tracking-tight uppercase text-black">Histórico Regional</h3>
                <div class="relative w-full md:w-80 text-black text-black">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-300 text-black text-black"></i>
                    <input type="text" id="tableSearch" placeholder="Pesquisar igreja..." class="w-full pl-12 pr-4 py-3 bg-gray-50 rounded-2xl text-sm font-medium outline-none border-none focus:ring-1 ring-black text-black text-black text-black" onkeyup="renderTable()">
                </div>
            </div>
            <div class="overflow-x-auto custom-scrollbar text-black text-black">
                <table class="w-full text-left text-sm text-black">
                    <thead>
                        <tr class="bg-gray-50/50 text-gray-400 font-black text-[10px] uppercase border-b border-gray-50 tracking-widest text-black">
                            <th class="px-8 py-5 text-black">Igreja</th>
                            <th class="px-6 py-5 text-center text-black">Mês/Ano</th>
                            <th class="px-6 py-5 text-right text-black text-black">Créditos</th>
                            <th class="px-6 py-5 text-right text-black text-black">Débitos</th>
                            <th class="px-8 py-5 text-right text-black text-black">Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="divide-y divide-gray-50 text-black"></tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- MODAL SENHA -->
    <div id="passwordModal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[150] hidden items-center justify-center p-4">
        <div class="bg-white rounded-[40px] p-12 max-w-sm w-full text-center shadow-2xl text-black">
            <i data-lucide="shield-check" class="w-12 h-12 mx-auto mb-8 text-black"></i>
            <h4 class="font-black text-2xl mb-2 uppercase text-black text-black">Acesso Administrativo</h4>
            <input type="password" id="adminPasswordInput" placeholder="••••" class="w-full text-center p-5 bg-gray-50 rounded-3xl border-none outline-none focus:ring-2 ring-black mb-6 text-3xl tracking-[0.8em] text-black">
            <button onclick="checkAdminPassword()" class="w-full py-5 bg-black text-white rounded-3xl text-xs font-black uppercase shadow-xl text-white text-white">Entrar</button>
            <button onclick="closeModal('passwordModal')" class="mt-6 text-[10px] font-black text-gray-300 uppercase hover:text-gray-500 text-black text-black">Voltar</button>
        </div>
    </div>

    <!-- MODAL ADMIN -->
    <div id="adminModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden items-center justify-center p-4 text-black text-black text-black">
        <div class="bg-white w-full max-w-3xl rounded-[40px] shadow-2xl overflow-hidden animate-in zoom-in duration-200 text-black text-black">
            <div class="p-8 bg-gray-50 border-b border-gray-100 flex items-center justify-between text-black text-black">
                <h3 class="font-black uppercase text-xl text-black tracking-tighter text-black text-black">Gestão Regional</h3>
                <div class="flex gap-2">
                    <button id="tabManualBtn" onclick="switchAdminTab('manual')" class="px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase bg-black text-white transition-all text-white">Lançar</button>
                    <button id="tabBulkBtn" onclick="switchAdminTab('bulk')" class="px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase bg-gray-100 text-gray-400 text-black text-black text-black">Importar</button>
                    <button onclick="exitAdmin()" class="btn-exit px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase flex items-center gap-2 text-white text-white">Sair</button>
                </div>
            </div>
            
            <div id="tabManual" class="p-10 space-y-6 text-black">
                <div class="grid grid-cols-2 gap-6 text-black text-black">
                    <select id="adminYear" class="p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-black font-bold text-black text-black">
                        <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option>
                    </select>
                    <select id="adminMonth" class="p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-black font-bold text-black text-black text-black text-black"></select>
                </div>
                <select id="adminChurch" class="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-black font-bold text-black text-black text-black text-black"></select>
                <div class="grid grid-cols-2 gap-6 text-black text-black text-black text-black text-black">
                    <input type="number" id="adminIncome" placeholder="Créditos" step="0.01" class="p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-blue-500 font-black text-black">
                    <input type="number" id="adminExpense" placeholder="Débitos" step="0.01" class="p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-rose-500 font-black text-black">
                </div>
                <button onclick="saveAdminData()" class="w-full py-5 bg-black text-white rounded-3xl text-xs font-black uppercase shadow-xl text-white text-white">Salvar Lançamento</button>
                
                <div class="pt-8 border-t border-gray-100 text-black text-black">
                    <p class="text-[10px] font-black uppercase text-gray-400 mb-4 text-center tracking-widest text-black text-black">Forçar Sincronização de Dados Reais</p>
                    <button id="btnSyncAll" onclick="forceSyncAll()" class="w-full mb-6 py-5 bg-blue-600 text-white rounded-[24px] text-[11px] font-black uppercase shadow-xl hover:bg-blue-700 transition-all text-white text-white">Sincronizar Base Completa (2023, 2024, 2025)</button>
                    <button onclick="resetRegionalData()" class="w-full mt-6 py-4 text-[10px] font-black text-rose-500 uppercase border border-rose-50 rounded-2xl hover:bg-rose-50 text-black">Limpar Firebase (Zerar Tudo)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FEEDBACK -->
    <div id="feedbackModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[200] hidden items-center justify-center p-4">
        <div class="bg-white rounded-[40px] p-10 max-w-xs w-full text-center shadow-2xl border border-gray-100 text-black text-black text-black">
            <h4 id="feedbackTitle" class="font-black mb-2 uppercase text-black text-black text-black text-black text-black">Aviso</h4>
            <p id="feedbackText" class="text-sm text-gray-400 font-medium mb-8 leading-relaxed text-black text-black"></p>
            <button onclick="closeModal('feedbackModal')" class="w-full py-4 bg-black text-white rounded-2xl text-[10px] font-black uppercase text-white">Fechar</button>
        </div>
    </div>

    <!-- IMPRESSÃO -->
    <div id="printSelectionModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[150] hidden items-center justify-center p-4 text-black text-black">
        <div class="bg-white rounded-[40px] p-10 max-w-md w-full text-center shadow-2xl text-black">
            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="printer" class="w-8 h-8 text-black text-black text-black"></i>
            </div>
            <h4 class="font-black text-xl uppercase mb-2 text-black">Gerar PDF Regional</h4>
            <div id="printOptsContainer" class="space-y-4 mb-8 text-left text-black"></div>
            
            <div class="mb-8 p-5 bg-gray-50 rounded-[24px] text-left text-black">
                <p class="text-[10px] font-black uppercase text-gray-400 mb-4 tracking-widest text-black text-black">Orientação</p>
                <div class="flex gap-4">
                    <label class="flex-1 flex items-center gap-3 p-3 bg-white rounded-xl border border-gray-100 cursor-pointer text-black">
                        <input type="radio" name="printOrient" value="landscape" checked class="accent-black text-black">
                        <span class="text-[10px] font-black uppercase text-black">Paisagem</span>
                    </label>
                    <label class="flex-1 flex items-center gap-3 p-3 bg-white rounded-xl border border-gray-100 cursor-pointer text-black text-black">
                        <input type="radio" name="printOrient" value="portrait" class="accent-black">
                        <span class="text-[10px] font-black uppercase text-black text-black text-black text-black text-black">Retrato</span>
                    </label>
                </div>
            </div>
            <div class="flex gap-4 text-black">
                <button onclick="closeModal('printSelectionModal')" class="flex-1 py-4 text-[10px] font-black text-gray-300 uppercase text-black text-black text-black">Cancelar</button>
                <button onclick="executePrint()" class="flex-2 px-10 py-4 bg-black text-white rounded-3xl text-[10px] font-black uppercase text-white">Gerar PDF</button>
            </div>
        </div>
    </div>

    <div id="printContainer" class="hidden text-black text-black text-black text-black text-black"></div>

    <script>
        Chart.register(ChartDataLabels);

        const COLOR_PALETTES = {
            default: { pos: '#3b82f6', neg: '#ef4444' }, emerald: { pos: '#10b981', neg: '#fb7185' },
            modern: { pos: '#6366f1', neg: '#f97316' }, vibrant: { pos: '#a855f7', neg: '#eab308' },
            ocean: { pos: '#06b6d4', neg: '#ec4899' }
        };

        const SECTORS = {
            "JARDIM ALMANARA": ["Jardim Almanara", "Parque Pedroso", "Vila Penteado", "Jardim dos Francos"],
            "VILA ACRE": ["Vila Acre", "Jardim das Graças", "Trivelato"],
            "CASA VERDE ALTA": ["Casa Verde Alta", "Casa Verde 2", "Vila Santista"],
            "VILA SANTA MARIA": ["Vila Santa Maria"]
        };
        const ALL_CHURCHES = Object.values(SECTORS).flat();
        const MONTHS = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
        const FULL_MONTHS = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

        const REAL_DATA = {
            "2023": {
                "Casa Verde Alta": [[10273.43, 3806.81], [7346.39, 3915.18], [10929.20, 3790.03], [10507.32, 3467.90], [7005.42, 4609.99], [8268.53, 5354.84], [7327.75, 4290.12], [5684.70, 4296.93], [6247.38, 4010.16], [5648.37, 4768.46], [7768.66, 4285.82], [6779.92, 3393.23]],
                "Vila Santista": [[7045.85, 2491.00], [7474.45, 2170.69], [7234.10, 2658.01], [11018.50, 2913.60], [9485.90, 3155.52], [17484.50, 3115.54], [9910.07, 3005.23], [10576.80, 3242.63], [9472.20, 3923.68], [9676.50, 3416.36], [11594.10, 2608.96], [12335.55, 2584.59]],
                "Casa Verde 2": [[1597.50, 1509.90], [1317.95, 1459.90], [1209.30, 1450.00], [1726.30, 1559.90], [1790.60, 1459.90], [1077.70, 1559.01], [1115.75, 1537.92], [2345.20, 1463.02], [1004.00, 1592.12], [1713.25, 1654.09], [2707.50, 1564.25], [3381.10, 1564.33]],
                "Vila Santa Maria": [[29661.25, 16542.17], [26877.17, 16099.69], [32692.17, 18338.44], [34067.69, 8576.94], [34809.28, 17324.07], [34690.50, 19273.81], [32343.05, 22998.37], [37650.07, 20733.00], [47369.69, 23044.91], [43236.48, 21976.80], [32027.78, 17747.67], [37210.78, 23708.78]],
                "Jardim Almanara": [[19636.52, 10032.76], [20764.30, 10033.11], [21427.25, 11973.59], [24671.78, 11859.84], [24003.60, 12135.50], [24255.92, 11423.73], [26159.26, 12295.29], [24532.80, 12320.19], [23209.35, 11621.26], [25976.35, 13032.74], [22937.05, 12155.49], [25446.90, 12030.43]],
                "Parque Pedroso": [[6088.00, 1981.98], [9324.30, 2062.00], [15354.45, 6553.87], [9674.25, 4819.03], [9506.68, 6105.98], [8658.00, 4936.52], [9663.30, 5630.36], [8130.60, 4431.79], [14678.40, 6098.92], [9583.75, 5289.35], [7369.00, 5789.15], [9889.95, 5092.00]],
                "Jardim dos Francos": [[5521.15, 1472.21], [5208.23, 1687.14], [4903.00, 1601.10], [5420.40, 1380.75], [4557.35, 1669.83], [4642.60, 1554.20], [4669.90, 1359.58], [6480.50, 1355.84], [6071.85, 1714.56], [4067.70, 1835.11], [4172.55, 1706.12], [5436.24, 1422.55]],
                "Vila Acre": [[7026.05, 3030.90], [6437.65, 1818.40], [6275.20, 2115.58], [5623.37, 1071.46], [5956.00, 2887.21], [6161.50, 4232.17], [6572.55, 2708.35], [6713.80, 2440.08], [5777.85, 4281.03], [7926.85, 2155.28], [5240.60, 1676.29], [6157.40, 2047.95]],
                "Jardim das Graças": [[1642.90, 1248.00], [1768.50, 1262.00], [1430.50, 1230.00], [1480.65, 1130.00], [1495.50, 1167.60], [2799.55, 1587.45], [4734.55, 4806.83], [6229.05, 4637.44], [6002.95, 4021.67], [5312.50, 3808.60], [5079.30, 3766.13], [8054.55, 3976.96]],
                "Trivelato": [[1562.00, 1450.28], [2386.00, 1336.60], [1807.00, 1476.16], [1752.00, 1317.00], [1910.00, 1317.00], [2156.00, 1467.00], [2301.00, 1429.29], [2071.00, 1420.95], [2060.00, 1317.00], [1998.00, 1620.10], [2449.00, 1339.00], [2489.33, 1322.00]]
            },
            "2024": {
                "Jardim Almanara": [[24210.05, 11410.27], [23816.50, 10862.06], [25344.12, 12999.58], [29588.00, 15401.27], [29419.15, 13130.35], [27611.85, 13515.90], [26651.75, 15317.99], [25473.25, 14330.27], [29174.01, 12366.60], [26316.96, 14118.13], [22608.20, 11876.59], [27828.72, 12550.25]],
                "Parque Pedroso": [[8021.12, 4975.05], [5683.65, 4552.69], [7701.80, 4663.36], [7435.26, 4843.36], [7424.90, 4669.32], [8498.57, 4765.24], [7163.28, 4902.83], [8140.46, 4446.82], [8197.90, 4540.47], [5766.98, 5334.96], [6086.62, 4586.43], [9728.08, 4245.57]],
                "Jardim dos Francos": [[4136.94, 1670.32], [4341.00, 2082.85], [5180.52, 1402.56], [3693.25, 1675.02], [4573.80, 1592.29], [4747.20, 1615.00], [4511.41, 2119.64], [4475.40, 1576.64], [5215.75, 1446.66], [4107.96, 1576.32], [2342.50, 574.88], [3374.18, 2302.66]],
                "Vila Santa Maria": [[29928.48, 17004.03], [34357.67, 17160.39], [35475.88, 15598.60], [32016.54, 23017.93], [34782.09, 20069.04], [40410.13, 25080.50], [35276.69, 20439.65], [34600.75, 20097.12], [42110.90, 17716.68], [33326.76, 21654.14], [36429.85, 20717.17], [43577.70, 23568.81]],
                "Casa Verde Alta": [[6843.99, 3391.29], [8194.35, 5369.92], [9274.11, 4858.59], [8976.98, 4997.71], [10056.74, 4627.47], [10334.07, 5869.25], [7643.34, 5708.52], [8953.56, 5503.66], [10577.30, 5053.11], [10159.03, 5266.87], [14000.10, 5789.02], [11744.21, 4367.17]],
                "Vila Santista": [[8838.30, 2577.94], [10014.37, 3470.16], [11818.25, 3988.40], [9488.55, 3777.46], [10898.05, 3718.37], [12138.35, 4024.75], [10467.00, 3948.95], [9901.45, 3137.71], [9614.62, 3208.63], [9003.18, 4048.26], [9681.13, 3091.36], [8144.21, 2338.91]],
                "Casa Verde 2": [[2014.90, 1740.18], [1879.50, 1704.39], [2021.60, 1573.86], [1362.50, 1563.18], [1309.45, 1529.26], [1518.85, 1511.17], [1632.80, 1547.27], [1295.00, 1400.00], [1307.00, 1464.69], [1630.50, 1712.29], [1862.55, 1760.00], [2150.30, 1498.26]],
                "Vila Acre": [[5767.55, 2211.50], [6011.80, 1893.00], [6039.10, 2905.91], [5767.80, 1526.02], [6585.65, 2272.20], [7024.70, 2084.90], [6814.95, 2501.26], [6239.75, 2362.51], [5139.25, 2624.59], [7611.15, 1755.90], [5836.50, 1451.90], [6035.30, 1717.89]],
                "Jardim das Graças": [[5783.87, 4329.05], [4606.40, 4074.50], [4851.68, 3829.39], [4525.75, 3856.43], [5445.75, 3849.23], [5884.10, 4143.44], [4744.05, 4020.45], [3559.94, 4153.05], [4226.80, 4993.78], [3704.80, 4396.45], [4026.60, 3733.60], [4009.40, 3593.83]],
                "Trivelato": [[1849.00, 1429.03], [2138.00, 1382.98], [2072.00, 1532.95], [2048.00, 1424.00], [1742.00, 1470.00], [1578.00, 1497.00], [1519.00, 1570.00], [520.65, 1370.00], [1372.00, 1370.00], [906.15, 1370.00], [970.00, 1370.00], [0,0]],
                "Vila Penteado": [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[208.10, 900.00], [626.75, 982.08]]
            },
            "2025": {
                "Vila Santa Maria": [[36406.88, 21628.86], [32428.73, 17876.48], [42919.42, 12521.66], [40342.41, 14724.52], [47245.26, 20671.54], [51866.91, 20659.45], [45793.88, 15676.66], [39910.34, 18602.73], [38304.46, 12348.84], [44820.19, 18019.31], [36955.95, 17239.50], [46396.40, 27732.63]],
                "Casa Verde Alta": [[8624.51, 4749.42], [7855.93, 4385.31], [11247.20, 5695.44], [9381.08, 6665.22], [8371.82, 6592.54], [8733.27, 6502.60], [9052.63, 6421.67], [9234.38, 6383.44], [10350.44, 7074.51], [9527.24, 7751.53], [11073.45, 7315.12], [10946.50, 6451.51]],
                "Vila Santista": [[10850.29, 2720.70], [9341.38, 2213.99], [8778.35, 3741.93], [7629.26, 3243.29], [9166.86, 3323.40], [8442.62, 3620.90], [9066.96, 3079.88], [10535.70, 4079.85], [5127.20, 2892.58], [7148.86, 3891.36], [8482.60, 3427.16], [7918.32, 3439.82]],
                "Casa Verde 2": [[1669.59, 1578.88], [1723.90, 1462.29], [1277.00, 1709.90], [1965.50, 1834.90], [1267.00, 1718.29], [1926.00, 1709.90], [1518.80, 1712.29], [1523.35, 1762.29], [2871.45, 1762.29], [2675.40, 2077.44], [2837.61, 2064.69], [2678.33, 2159.90]],
                "Vila Acre": [[5063.65, 1535.08], [5089.55, 1723.47], [6310.00, 2564.91], [5471.55, 3035.72], [6531.65, 2782.21], [5829.70, 2257.62], [6170.00, 4977.92], [6318.25, 2683.28], [5938.15, 2224.21], [5692.20, 2840.92], [4799.70, 1513.44], [5380.90, 1475.36]],
                "Jardim das Graças": [[3865.20, 3801.55], [3783.40, 3918.50], [4885.95, 4511.81], [4687.92, 4205.24], [4113.00, 4729.71], [5794.10, 4232.13], [3105.55, 4359.57], [3213.10, 4288.94], [2647.65, 3989.44], [5938.35, 4773.64], [2093.69, 3834.81], [3247.24, 4261.22]],
                "Trivelato": [[1125.20, 1370.00], [1629.00, 1370.00], [1621.00, 1620.00], [1914.00, 1692.90], [1659.00, 1635.24], [1903.00, 1695.00], [1736.00, 1770.00], [1633.00, 1620.00], [1623.00, 1620.00], [1947.00, 1770.00], [1577.50, 1620.00], [1521.00, 1678.39]],
                "Jardim Almanara": [[28351.21, 11747.40], [31302.35, 12142.21], [29054.01, 15722.57], [24560.61, 13312.25], [30109.16, 18455.23], [33938.60, 16607.97], [31815.14, 17629.14], [33027.98, 17458.88], [30807.09, 20770.29], [32807.53, 20122.32], [32689.69, 17411.01], [30009.14, 19011.01]],
                "Parque Pedroso": [[5584.22, 4053.88], [6423.95, 3871.08], [4815.36, 1939.41], [6163.20, 0], [7092.20, 5035.02], [5306.40, 3551.90], [7137.40, 4004.02], [5904.90, 4063.10], [6490.15, 4222.28], [6235.45, 3775.72], [7453.30, 2408.68], [7204.05, 3783.71]],
                "Jardim dos Francos": [[1682.45, 1442.46], [2333.30, 1536.43], [2472.45, 2237.81], [1816.63, 1796.77], [2087.95, 1846.65], [2252.25, 2056.83], [2532.35, 1911.76], [1933.65, 1608.93], [1859.45, 1653.52], [1831.24, 1981.24], [2335.75, 1925.23], [2209.75, 1944.22]],
                "Vila Penteado": [[476.50, 900.00], [1198.00, 900.00], [639.42, 1230.00], [981.25, 1059.00], [598.00, 1163.00], [666.60, 1083.41], [656.65, 1053.00], [485.10, 1203.00], [691.45, 1283.24], [972.50, 1753.00], [6173.0, 1473.0], [2907.75, 1753.0]]
            }
        };

        // --- FIREBASE INIT ---
        const appId = 'regional-santa-maria-persistence-v3';
        let db, auth;
        let currentData = [];
        let mainChart, pieChart, rankingChart;
        let isTableVisible = false;

        window.onload = async () => {
            const firebaseConfig = {
                apiKey: "AIzaSyCnorDiiAufnAchlggOhXuIFPcBK5WC_Q4",
                authDomain: "dashboardfinanceiroregional.firebaseapp.com",
                projectId: "dashboardfinanceiroregional",
                storageBucket: "dashboardfinanceiroregional.firebasestorage.app",
                messagingSenderId: "99827707619",
                appId: "1:99827707619:web:800bb5462c56ee13519fd6",
                measurementId: "G-2RNPQDS1Z1"
            };
            
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();

            lucide.createIcons();
            initChurchOptions();
            generateSelectors();

            try {
                await auth.signInAnonymously();
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        updateSyncStatus('connected', 'Sincronizado');
                        setupFirestoreListener();
                    } else {
                        updateSyncStatus('error', 'Sem Sessão');
                    }
                });
            } catch (e) {
                console.error(e);
                updateSyncStatus('error', 'Falha na Conexão');
            }
        };

        function updateSyncStatus(type, text) {
            const dot = document.getElementById('sync-dot');
            const txt = document.getElementById('sync-text');
            if (dot && txt) {
                dot.className = `w-2 h-2 rounded-full ${type === 'connected' ? 'bg-green-500 animate-pulse' : (type === 'error' ? 'bg-red-500' : 'bg-gray-300')}`;
                txt.innerText = text;
            }
        }

        function initChurchOptions() {
            const filter = document.getElementById('churchFilter');
            if(filter) {
                filter.innerHTML = '<option value="Todas">Todas Igrejas</option>';
                [...ALL_CHURCHES].sort().forEach(n => {
                    const o = document.createElement('option');
                    o.value = n; o.textContent = n; filter.appendChild(o);
                });
            }
        }

        function onSectorChange() {
            const sector = document.getElementById('sectorFilter').value;
            const churchFilter = document.getElementById('churchFilter');
            if(!churchFilter) return;

            churchFilter.innerHTML = '<option value="Todas">Todas Igrejas</option>';
            const list = sector === "Todos" ? ALL_CHURCHES : (SECTORS[sector] || []);
            [...list].sort().forEach(n => {
                const o = document.createElement('option');
                o.value = n; o.textContent = n; churchFilter.appendChild(o);
            });
            updateDashboard();
        }

        async function setupFirestoreListener() {
            if (!auth.currentUser) return;
            const col = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('records');
            col.onSnapshot((snap) => {
                if (snap.empty) { seedInitialData(col); return; }
                currentData = snap.docs.map(d => d.data());
                updateDashboard();
            }, (error) => {
                console.error(error);
                updateSyncStatus('error', 'Erro Permissão');
            });
        }

        async function seedInitialData(col) {
            const batch = db.batch();
            ALL_CHURCHES.forEach(church => {
                ["2023", "2024", "2025"].forEach(year => {
                    for (let m = 0; m < 12; m++) {
                        let inc = 0, exp = 0;
                        if(REAL_DATA[year] && REAL_DATA[year][church] && REAL_DATA[year][church][m]) {
                            inc = REAL_DATA[year][church][m][0]; exp = REAL_DATA[year][church][m][1];
                        }
                        batch.set(col.doc(`${church}_${year}_${m}`), { 
                            church, year: parseInt(year), month: MONTHS[m], income: inc, expense: exp, status: inc > 0 ? "Real" : "Vazio" 
                        }, { merge: true });
                    }
                });
            });
            return batch.commit();
        }

        async function forceSyncAll() {
            if (!auth.currentUser) return;
            if(!confirm("Gravar base COMPLETA no Firebase? Isso salvará os dados permanentemente.")) return;
            const btn = document.getElementById('btnSyncAll');
            const orig = btn.innerText; btn.innerText = "GRAVANDO..."; btn.disabled = true;
            try {
                const col = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('records');
                await seedInitialData(col);
                showFeedback("Concluído", "Todos os dados foram salvos definitivamente no servidor.");
            } catch (e) { showFeedback("Erro", "Erro ao gravar no Firebase."); }
            finally { btn.innerText = orig; btn.disabled = false; }
        }

        function updateDashboard() {
            const yEl = document.getElementById('yearFilter');
            const sEl = document.getElementById('sectorFilter');
            const cEl = document.getElementById('churchFilter');
            if(!yEl || !sEl || !cEl) return;

            const year = parseInt(yEl.value);
            const sector = sEl.value;
            const church = cEl.value;
            
            let filtered = currentData.filter(d => d.year === year);
            if (sector !== "Todos" && SECTORS[sector]) {
                filtered = filtered.filter(d => SECTORS[sector].includes(d.church));
            }
            if (church !== "Todas") {
                filtered = filtered.filter(d => d.church === church);
            }
            
            const totalInc = filtered.reduce((a, b) => a + b.income, 0);
            const totalExp = filtered.reduce((a, b) => a + b.expense, 0);
            
            document.getElementById('kpi-income').innerText = `R$ ${totalInc.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('kpi-expense').innerText = `R$ ${totalExp.toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('kpi-balance').innerText = `R$ ${(totalInc - totalExp).toLocaleString('pt-BR', {minimumFractionDigits:2})}`;
            document.getElementById('kpi-active').innerText = `${[...new Set(filtered.filter(d => d.income > 0 || d.expense > 0).map(d => d.church))].length} Unidades`;

            renderCharts(filtered);
            renderTable(filtered);
        }

        const currencyFormatter = (val) => 'R$ ' + Math.round(val).toLocaleString('pt-BR');

        function renderCharts(data) {
            const incs = MONTHS.map(m => data.filter(d => d.month === m).reduce((a,b) => a+b.income, 0));
            const exps = MONTHS.map(m => data.filter(d => d.month === m).reduce((a,b) => a+b.expense, 0));
            const pMain = COLOR_PALETTES[document.getElementById('colorMain').value];
            const showM = document.getElementById('showLabelsMain').checked;
            const showP = document.getElementById('showLabelsPie').checked;
            const showR = document.getElementById('showLabelsRanking').checked;
            const labelConfig = (visible) => ({ display: visible, color: '#000', font: { weight: 'bold', size: 9 }, formatter: (v) => v > 0 ? currencyFormatter(v) : '', anchor: 'end', align: 'top', offset: 4 });

            if (mainChart) mainChart.destroy();
            mainChart = new Chart(document.getElementById('mainChart'), { type: 'bar', data: { labels: MONTHS, datasets: [{ label: 'Entradas', data: incs, backgroundColor: pMain.pos, borderRadius: 6, datalabels: labelConfig(showM) }, { label: 'Saídas', data: exps, backgroundColor: pMain.neg, borderRadius: 6, datalabels: labelConfig(showM) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, datalabels: labelConfig(showM) } } });
            if (pieChart) pieChart.destroy();
            pieChart = new Chart(document.getElementById('pieChart'), { type: 'doughnut', data: { labels: ['Entradas', 'Saídas'], datasets: [{ data: [incs.reduce((a,b)=>a+b,0) || 1, exps.reduce((a,b)=>a+b,0) || 0], backgroundColor: ['#3b82f6', '#ef4444'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, datalabels: { display: showP, color: '#fff', font: { weight: 'bold' }, formatter: (v, ctx) => { let sum = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0); return (v * 100 / sum).toFixed(1) + "%"; } } } } });
            const balances = ALL_CHURCHES.map(name => { const d = data.filter(i => i.church === name); return { n: name, b: d.reduce((a,c)=>a+c.income, 0) - d.reduce((a,c)=>a+c.expense, 0) }; }).sort((a,b) => b.b - a.b);
            if (rankingChart) rankingChart.destroy();
            rankingChart = new Chart(document.getElementById('rankingChart'), { type: 'bar', data: { labels: balances.map(x => x.n), datasets: [{ data: balances.map(x => x.b), backgroundColor: balances.map(x => x.b >= 0 ? '#3b82f6' : '#ef4444'), borderRadius: 8 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, datalabels: { ...labelConfig(showR), align: 'right', anchor: 'end', formatter: (v) => currencyFormatter(v) } } } });
        }

        function requestAdminAccess() { document.getElementById('adminPasswordInput').value = ''; showModal('passwordModal'); }
        function checkAdminPassword() { if (document.getElementById('adminPasswordInput').value === "1234") { closeModal('passwordModal'); openAdminModal(); } else { showFeedback("Erro", "Senha incorreta."); } }
        function exitAdmin() { closeModal('adminModal'); showFeedback("Fim", "Sessão encerrada."); }
        function openAdminModal() { document.getElementById('adminChurch').innerHTML = [...ALL_CHURCHES].sort().map(c => `<option value="${c}">${c}</option>`).join(''); showModal('adminModal'); }
        function switchAdminTab(tab) {
            const isM = tab === 'manual';
            document.getElementById('tabManual').classList.toggle('hidden', !isM);
            document.getElementById('tabBulk').classList.toggle('hidden', isM);
            document.getElementById('tabManualBtn').className = isM ? "px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase bg-black text-white transition-all" : "px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase bg-gray-100 text-gray-400";
        }

        async function saveAdminData() {
            const ch = document.getElementById('adminChurch').value; const yr = parseInt(document.getElementById('adminYear').value); const mt = document.getElementById('adminMonth').value; const inc = parseFloat(document.getElementById('adminIncome').value) || 0; const exp = parseFloat(document.getElementById('adminExpense').value) || 0;
            const mIdx = MONTHS.indexOf(mt);
            await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('records').doc(`${ch}_${yr}_${mIdx}`).set({ church: ch, year: yr, month: mt, income: inc, expense: exp, status: "Real" }, { merge: true });
            closeModal('adminModal'); showFeedback("Salvo", "Sucesso.");
        }

        function toggleTableVisibility() { isTableVisible = !isTableVisible; document.getElementById('tableSection').classList.toggle('hidden', !isTableVisible); document.getElementById('toggleText').innerText = isTableVisible ? "Ocultar Detalhes" : "Ver Listagem Completa"; }

        function renderTable(dataInput) {
            const body = document.getElementById('dataTableBody'); if(!body) return;
            body.innerHTML = "";
            const rows = (dataInput || currentData).sort((a,b) => b.income - a.income);
            rows.forEach(r => { if(r.income === 0 && r.expense === 0) return; const tr = document.createElement('tr'); tr.innerHTML = `<td class="px-8 py-5 font-bold text-black text-black">${r.church}</td><td class="px-6 py-5 text-center text-gray-400 font-bold text-black">${r.month}/${r.year}</td><td class="px-6 py-5 text-right text-blue-600 font-black">R$ ${r.income.toLocaleString('pt-BR')}</td><td class="px-6 py-5 text-right text-rose-600 font-black text-black">R$ ${r.expense.toLocaleString('pt-BR')}</td><td class="px-8 py-5 text-right font-black text-black">R$ ${(r.income - r.expense).toLocaleString('pt-BR')}</td>`; body.appendChild(tr); });
        }

        function showPrintSelection() { showModal('printSelectionModal'); }
        function executePrint() {
            const cont = document.getElementById('printContainer'); cont.innerHTML = '';
            const orientation = document.querySelector('input[name="printOrient"]:checked').value;
            document.body.classList.remove('print-landscape', 'print-portrait');
            document.body.classList.add(orientation === 'landscape' ? 'print-landscape' : 'print-portrait');

            const sector = document.getElementById('sectorFilter').value;
            const church = document.getElementById('churchFilter').value;
            const year = document.getElementById('yearFilter').value;
            let filterHeader = sector === "Todos" ? "CONSOLIDADO REGIONAL" : `SETOR: ${sector}${church !== "Todas" ? ` | IGREJA: ${church}` : " | TODAS AS IGREJAS"}`;

            const opts = [{id:'printMain',t:'Fluxo Mensal',c:'mainChart'},{id:'printPie',t:'Saúde Financeira',c:'pieChart'},{id:'printRanking',t:'Ranking Regional',c:'rankingChart'}];
            opts.forEach(o => { if (document.getElementById(o.id).checked) { 
                const p = document.createElement('div'); p.className = 'print-page'; 
                p.innerHTML = `<div style="display: flex; align-items: center; border-bottom:3px solid #000; padding-bottom:10px; width:100%; margin-bottom:40px; color: black;"><img src="https://via.placeholder.com/150x150?text=LOGO" style="width: 60px; height: 60px; object-fit: contain; margin-right: 20px;"><div style="flex-grow: 1; text-align: center;"><h1 style="font-size:22px; font-weight:900; margin:0;">AD.PERUS - REGIONAL SANTA MARIA</h1><p style="font-size:14px; font-weight:800; margin: 5px 0; text-transform: uppercase;">${filterHeader}</p><p style="font-size:12px; font-weight:700; margin:0;">RELATÓRIO: ${o.t.toUpperCase()} | ANO: ${year}</p></div></div><img src="${document.getElementById(o.c).toDataURL()}" style="width:100%; max-height:75%; object-fit:contain;"><div style="margin-top:40px; font-size:10px; color:#999; text-align:right; width:100%;">Emitido em: ${new Date().toLocaleString()}</div>`; 
                cont.appendChild(p); 
            } });
            if (!cont.innerHTML) return;
            closeModal('printSelectionModal'); setTimeout(() => window.print(), 500);
        }

        async function processBulkPaste() {
            const text = document.getElementById('bulkDataInput').value; const year = parseInt(document.getElementById('bulkYear').value); const lines = text.split('\n'); const batch = db.batch(); const col = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('records'); let count = 0;
            lines.forEach(line => { if (!line.trim()) return; const regex = /^(.*?)\s+(Jan|Fev|Mar|Abr|Mai|Jun|Jul|Ago|Set|Out|Nov|Dez)\s+R\$\s*([\d.,]+)\s+R\$\s*([\d.,]+)/i; const match = line.match(regex); if (match) { const church = ALL_CHURCHES.find(c => c.toLowerCase().includes(match[1].trim().toLowerCase())) || match[1].trim(); const mIdx = MONTHS.indexOf(match[2].charAt(0).toUpperCase() + match[2].slice(1).toLowerCase()); const incVal = parseFloat(match[3].replace(/\./g, '').replace(',', '.')); const expVal = parseFloat(match[4].replace(/\./g, '').replace(',', '.')); if (mIdx !== -1 && ALL_CHURCHES.includes(church)) { batch.set(col.doc(`${church}_${year}_${mIdx}`), { church, year, month: MONTHS[mIdx], income: incVal, expense: expVal, status: "Real" }, { merge: true }); count++; } } });
            if (count > 0) { await batch.commit(); closeModal('adminModal'); showFeedback("Sucesso", `${count} lançamentos.`); } else { showFeedback("Erro", "Formato inválido."); }
        }

        function generateSelectors() {
            const adminMonth = document.getElementById('adminMonth');
            if(adminMonth) adminMonth.innerHTML = MONTHS.map((m, i) => `<option value="${m}">${FULL_MONTHS[i]}</option>`).join('');
            const printContainer = document.getElementById('printOptsContainer');
            if(printContainer) {
                const printList = [{id:'printMain',t:'Fluxo Regional'},{id:'printPie',t:'Saúde Financeira'},{id:'printRanking',t:'Ranking de Saldo'}];
                printContainer.innerHTML = printList.map(p => `<label class="flex items-center gap-4 p-5 bg-gray-50 rounded-[24px] cursor-pointer hover:bg-gray-100 transition-all text-black"><input type="checkbox" id="${p.id}" checked class="w-5 h-5 accent-black text-black"><span class="text-[10px] font-black uppercase text-gray-600 text-black text-black">${p.t}</span></label>`).join('');
            }
        }

        function showFeedback(title, text) { document.getElementById('feedbackTitle').innerText = title; document.getElementById('feedbackText').innerText = text; showModal('feedbackModal'); }
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); document.getElementById(id).classList.add('flex'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }
        const total = arr => arr.reduce((a, b) => a + b, 0);
    </script>
</body>
</html>
